<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>HackRU Project - Gemini Chat</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  <style>
    body { font-family: Arial, sans-serif; background:#011d38; text-align:center; }
    #chatbox { width: 500px; margin: 40px auto; background: #011d38; border-radius: 10px; border-color: blue; padding: 20px; }
    #messages { height: 300px; overflow-y: auto; text-align: left; margin-bottom: 10px; color:white; }
    input, button { padding: 8px; font-size: 16px; }
    button { background-color: #00c6ff; color:white; border:none; border-radius:5px; cursor:pointer; }
    button:hover { background-color: #00c6ff; }
    #userInput { width: 70%;}
  </style>
</head>
<body>
  <header>
    <div class="header">
      <a href="/home" class="btn btn-primary d-block mb-1" style="width: 180px; margin: 1px 0;">AImpulse</a>
      <div class="buttons">
        <a href="/track" class="btn btn-primary d-block mb-1" style="width: 180px; margin: 5px auto;">Track</a>
        <a href="/chatbot" class="btn btn-primary d-block mb-1" style="width: 180px; margin: 5px auto;">Chatbot</a>
        <a href="/analysis" class="btn btn-primary d-block mb-1" style="width: 180px; margin: 5px auto;">Sign Out</a>
      </div>
    </div>
  </header>
  <h2>Get investment advice from Gemini</h2>
  <div id="chatbox">
    <div id="messages"></div>
    <input id="userInput" placeholder="Ask Gemini something..." />
    <button onclick="sendMessage()">Send</button>
  </div>

  <script>
    async function sendMessage() {
      const input = document.getElementById("userInput");
      const messages = document.getElementById("messages");

      if (!input.value.trim()) return;

      // Show user's message
      const userMsg = document.createElement("div");
      userMsg.textContent = "You: " + input.value;
      messages.appendChild(userMsg);

      // Send to Flask /ask
      const res = await fetch("/ask", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message: input.value }),
        credentials: "same-origin"   // <-- important to keep session
      });
      const data = await res.json();

      // Show Gemini's reply
      const botMsg = document.createElement("div");
      botMsg.textContent = "Gemini: " + data.reply;
      messages.appendChild(botMsg);

      // Clear input and scroll
      input.value = "";
      messages.scrollTop = messages.scrollHeight;
    }
  </script>
</body>
</html>
